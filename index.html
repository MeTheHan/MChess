<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MChess - Çalışan Satranç</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 20px; 
            background: #2c3e50;
            color: white;
        }
        #board { 
            width: 400px; 
            margin: 20px auto; 
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #2980b9; }
        .status {
            font-size: 18px;
            margin: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>♔ MChess - Satranç Oyunu</h1>
    <div class="status" id="status">Oyun başladı! Beyaz hamle yapın.</div>
    <div id="board"></div>
    <div>
        <button onclick="newGame()">Yeni Oyun</button>
        <button onclick="undoMove()">Geri Al</button>
        <button onclick="flipBoard()">Tahtayı Çevir</button>
        <button onclick="toggleAI()" id="aiBtn">AI: Açık</button>
    </div>
    <div id="moves" style="margin: 20px; font-family: monospace;"></div>

    <script src="https://unpkg.com/chess.js@0.11.0/lib/chess.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

    <script>
    // Lichess'ten ücretsiz taşlar kullanıyoruz (kesin çalışır)
    function pieceTheme(piece) {
        // Lichess'in ücretsiz SVG taşları
        const pieces = {
            'wK': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wK.svg',
            'wQ': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wQ.svg',
            'wR': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wR.svg',
            'wB': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wB.svg',
            'wN': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wN.svg',
            'wP': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/wP.svg',
            'bK': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bK.svg',
            'bQ': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bQ.svg',
            'bR': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bR.svg',
            'bB': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bB.svg',
            'bN': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bN.svg',
            'bP': 'https://lichess1.org/assets/_Oo5YQb/piece/merida/bP.svg'
        };
        return pieces[piece];
    }

    let game = new Chess();
    let board = null;
    let aiEnabled = true;

    function initBoard() {
        board = Chessboard('board', {
            position: 'start',
            pieceTheme: pieceTheme,
            draggable: true,
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
        });
        updateStatus();
    }

    function onDragStart(source, piece) {
        if (game.game_over()) return false;
        if (piece.search(/^b/) !== -1 && game.turn() === 'w') return false;
        if (piece.search(/^w/) !== -1 && game.turn() === 'b') return false;
        return true;
    }

    function onDrop(source, target) {
        const move = game.move({
            from: source,
            to: target,
            promotion: 'q'
        });
        
        if (move === null) return 'snapback';
        
        updateStatus();
        updateMoves();
        
        if (aiEnabled && game.turn() === 'b' && !game.game_over()) {
            setTimeout(makeAIMove, 500);
        }
        
        return true;
    }

    function onSnapEnd() {
        board.position(game.fen());
    }

    function makeAIMove() {
        const moves = game.moves();
        if (moves.length === 0) return;
        
        const randomMove = moves[Math.floor(Math.random() * moves.length)];
        game.move(randomMove);
        board.position(game.fen());
        
        updateStatus();
        updateMoves();
    }

    function updateStatus() {
        let status = '';
        
        if (game.in_checkmate()) {
            status = 'Şah mat! ' + (game.turn() === 'w' ? 'Siyah' : 'Beyaz') + ' kazandı!';
        } else if (game.in_draw()) {
            status = 'Berabere!';
        } else if (game.in_check()) {
            status = 'Şah! Sıra: ' + (game.turn() === 'w' ? 'Beyaz' : 'Siyah');
        } else {
            status = 'Sıra: ' + (game.turn() === 'w' ? 'Beyaz' : 'Siyah');
        }
        
        document.getElementById('status').textContent = status;
    }

    function updateMoves() {
        const movesDiv = document.getElementById('moves');
        const moves = game.history();
        let movesText = '';
        
        for (let i = 0; i < moves.length; i += 2) {
            const moveNum = Math.floor(i / 2) + 1;
            const whiteMove = moves[i];
            const blackMove = moves[i + 1] || '';
            movesText += `${moveNum}. ${whiteMove} ${blackMove}<br>`;
        }
        
        movesDiv.innerHTML = movesText;
    }

    function newGame() {
        game = new Chess();
        board.start();
        updateStatus();
        updateMoves();
        
        if (aiEnabled && game.turn() === 'b') {
            setTimeout(makeAIMove, 500);
        }
    }

    function undoMove() {
        game.undo();
        if (aiEnabled) game.undo();
        board.position(game.fen());
        updateStatus();
        updateMoves();
    }

    function flipBoard() {
        board.flip();
    }

    function toggleAI() {
        aiEnabled = !aiEnabled;
        document.getElementById('aiBtn').textContent = 
            'AI: ' + (aiEnabled ? 'Açık' : 'Kapalı');
    }

    // Sayfa yüklendiğinde başlat
    window.onload = initBoard;
    </script>
</body>
</html>
